generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============ 사용자 ============
model User {
  id           String         @id @default(uuid())
  email        String         @unique
  password     String
  nickname     String         @unique
  profileImage String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  readings     Reading[]
  progress     UserProgress[]
  dailyCards   DailyCard[]
  sajuReadings SajuReading[]

  @@map("users")
}

// ============ 타로 카드 ============
model Card {
  id              Int            @id @default(autoincrement())
  nameKo          String
  nameEn          String
  type            String         // MAJOR, MINOR
  suit            String?        // WANDS, CUPS, SWORDS, PENTACLES
  number          Int
  imageUrl        String
  keywords        String         // JSON array stored as string
  uprightMeaning  String
  reversedMeaning String
  symbolism       String
  love            String
  career          String
  health          String
  finance         String

  readingCards ReadingCard[]
  userProgress UserProgress[]
  dailyCards   DailyCard[]

  @@map("cards")
}

// ============ 스프레드 ============
model Spread {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  cardCount   Int
  difficulty  Int
  positions   String   // JSON stored as string
  imageUrl    String?
  category    String   @default("general")

  readings Reading[]

  @@map("spreads")
}

// ============ 리딩 ============
model Reading {
  id             String   @id @default(uuid())
  userId         String
  spreadId       Int
  question       String?
  interpretMode  String   // TRADITIONAL, AI
  interpretation String?
  note           String?
  tags           String   @default("[]") // JSON array stored as string
  createdAt      DateTime @default(now())

  user   User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  spread Spread        @relation(fields: [spreadId], references: [id])
  cards  ReadingCard[]

  @@map("readings")
}

// ============ 리딩 카드 ============
model ReadingCard {
  id             String  @id @default(uuid())
  readingId      String
  cardId         Int
  position       Int
  isReversed     Boolean
  interpretation String?

  reading Reading @relation(fields: [readingId], references: [id], onDelete: Cascade)
  card    Card    @relation(fields: [cardId], references: [id])

  @@map("reading_cards")
}

// ============ 학습 진도 ============
model UserProgress {
  id         String   @id @default(uuid())
  userId     String
  cardId     Int
  isLearned  Boolean  @default(false)
  note       String?
  isFavorite Boolean  @default(false)
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  card Card @relation(fields: [cardId], references: [id])

  @@unique([userId, cardId])
  @@map("user_progress")
}

// ============ 오늘의 카드 ============
model DailyCard {
  id         String   @id @default(uuid())
  userId     String
  cardId     Int
  date       DateTime
  isReversed Boolean
  message    String?
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  card Card @relation(fields: [cardId], references: [id])

  @@unique([userId, date])
  @@map("daily_cards")
}

// ============ 사주 리딩 ============
model SajuReading {
  id             String   @id @default(uuid())
  userId         String
  name           String   // 대상자 이름
  birthDate      DateTime // 생년월일
  birthTime      String?  // 생시 (HH:mm 형식, 없으면 시주 제외)
  isLunar        Boolean  @default(false) // 음력 여부
  gender         String   @default("unknown") // male, female, unknown

  // 사주 팔자 (Four Pillars)
  yearStem       String   // 년간 (천간)
  yearBranch     String   // 년지 (지지)
  monthStem      String   // 월간 (천간)
  monthBranch    String   // 월지 (지지)
  dayStem        String   // 일간 (천간) - 일주의 주체
  dayBranch      String   // 일지 (지지)
  hourStem       String?  // 시간 (천간)
  hourBranch     String?  // 시지 (지지)

  // 오행 분포
  woodCount      Int      @default(0) // 목
  fireCount      Int      @default(0) // 화
  earthCount     Int      @default(0) // 토
  metalCount     Int      @default(0) // 금
  waterCount     Int      @default(0) // 수

  // 해석
  interpretation String?  // AI 또는 전통 해석 결과

  createdAt      DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("saju_readings")
}
